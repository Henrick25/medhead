name: My Applications Workflow

on: 
  push:
    branches: 
      - main
    paths:
      - 'api/**'
      - 'web/**'
      - 'apiReservation/**'
  pull_request:
    branches: 
      - master
    paths:
      - 'api/**'
      - 'web/**'
      - 'apiReservation/**'

jobs:
  setup-and-test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        include:
          - project: 'api'
            directory: './api'
            test_script: './mvnw test'
          - project: 'web'
            directory: './web'
            test_script: 'npm run e2e'
          - project: 'apiReservation'
            directory: './apiReservation'
            test_script: './mvnw test'
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up JDK 17 for Java projects
        if: matrix.project == 'api' || matrix.project == 'apiReservation'
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'adopt'

      - name: Setup Node.js for Web project
        if: matrix.project == 'web'
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - uses: browser-actions/setup-chrome@latest
        if: matrix.project == 'web'

      - name: Install dependencies
        working-directory: ${{ matrix.directory }}
        run: |
          if [ "${{ matrix.project }}" = "web" ]; then
            npm install
          else
            ./mvnw clean package
          
      - name: Run tests
        working-directory: ${{ matrix.directory }}
        run: ${{ matrix.test_script }}
